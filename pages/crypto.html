<!DOCTYPE html>
<html lang="cs">

<head>
  <meta charset="UTF-8">
  <title>Anatomie kÅ™ivky a podpisu</title>
  <meta property="og:title" content="Anatomie kÅ™ivky a podpisu">
  <link rel="shortcut icon" href="https://btc-slovnik.cz/favicon.png">
  <link rel="stylesheet" href="../css/styles.css">
  <meta name="description"
        content="VysvÄ›tluje zÃ¡klady asymetrickÃ© kryptografie a jejÃ­ vyuÅ¾itÃ­ v podepisovÃ¡nÃ­ bitcoinovÃ½ch transakcÃ­.">
  <meta property="og:description" content="VysvÄ›tluje zÃ¡klady asymetrickÃ© kryptografie a jejÃ­ vyuÅ¾itÃ­ v podepisovÃ¡nÃ­ bitcoinovÃ½ch transakcÃ­.">
  <meta name="keywords"
        content="bitcoin, kryptografie, asymetrickÃ¡, eliptickÃ¡ kÅ™ivka, diskrÃ©tnÃ­ logaritmus, koneÄnÃ© tÄ›leso, cyklickÃ¡ grupa, schnorr, podpis, tranasakce, podpis">
  <link rel="canonical" href="https://btc-slovnik.cz/pages/crypto.html">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@btcslovnik" />
  <meta name="og:image" content="https://btc-slovnik.cz/img/secp256k1.png" />
</head>

<body>
  <header>
    <div class="h1">
      <h1><a href="https://btc-slovnik.cz/#asym-crypto"><span>BitcoinovÃ½</span> slovnÃ­k nauÄnÃ½</a></h1>
    </div>
  </header>
  <div class="container2">
    <article>
      <header>
        <h2 id="curve">Anatomie kÅ™ivky</h2>
        <p class="header"><time datetime="2021-07-02">AktualizovÃ¡no: 2. 7. 2021</time></p>
      </header>
      <p class="just">Jak je moÅ¾nÃ© vidÄ›t na strÃ¡nce <a href="https://btc-slovnik.cz/pages/transaction.html">anatomie transakce a skriptu</a>, standardnÃ­ p2(w)pk transakce uzamykÃ¡ (prostÅ™ednictvÃ­m scriptPubKey) urÄitÃ½ obnos satoshi ve prospÄ›ch urÄitÃ©ho hashe veÅ™ejnÃ©ho klÃ­Äe (kterÃ½ zakÃ³dovanÃ½ v Bech32 Äi starÅ¡Ã­ Base58Check pÅ™edstavuje adresu). ProstÅ™ednictvÃ­m scriptSigu lze pak poskytnutÃ­m veÅ™ejnÃ©ho klÃ­Äe a podpisu tento vÃ½stup odemknout a utratit v dalÅ¡Ã­ transakci. To je umoÅ¾nÄ›no dÃ­ky tzv. asymetrickÃ© kryptografii, kterou v pÅ™Ã­padÄ› Bitcoinu pÅ™edstavuje kryptografie eliptickÃ½ch kÅ™ivek. </p>
      <p class="just">AsymetrickÃ¡ kryptografie se od tÃ© bÄ›Å¾nÃ© &ndash; symetrickÃ© &ndash; liÅ¡Ã­ tÃ­m, Å¾e na mÃ­sto jednoho a toho samÃ©ho klÃ­Äe (pouÅ¾itÃ©ho pro zaÅ¡ifrovÃ¡nÃ­ i deÅ¡ifrovÃ¡nÃ­) pouÅ¾Ã­vÃ¡ pÃ¡r klÃ­ÄÅ¯ &ndash; veÅ™ejnÃ½ a soukromÃ½. Pokud si pÅ™Ã­jemce zprÃ¡vy vygeneruje takovÃ½ pÃ¡r klÃ­ÄÅ¯ a ten veÅ™ejnÃ½ publikuje, kdokoliv mÅ¯Å¾e tÃ­mto veÅ™ejnÃ½m klÃ­Äem zaÅ¡ifrovat zprÃ¡vu, kterou bude moci deÅ¡ifrovat jen a pouze pÅ™Ã­jemce pomocÃ­ svÃ©ho soukromÃ©ho klÃ­Äe. AsymetrickÃ¡ kryptografie vÅ¡ak umoÅ¾Åˆuje, kromÄ› Å¡ifrovÃ¡nÃ­ za ÃºÄelem skrytÃ­ tajnÃ© zprÃ¡vy, takÃ© Å¡ifrovÃ¡nÃ­ za ÃºÄelem podpisu zprÃ¡vy. Pokud pÅ¯vodce zprÃ¡vy tuto zprÃ¡vu (v praxi staÄÃ­ pouze jejÃ­ hash) zaÅ¡ifruje svÃ½m soukromÃ½m klÃ­Äem, kaÅ¾dÃ½ mÅ¯Å¾e jeho publikovanÃ½m veÅ™ejnÃ½m klÃ­Äem zprÃ¡vu deÅ¡ifrovat a tÃ­m ovÄ›Å™it, Å¾e pÅ¯vodce zprÃ¡vy je prÃ¡vÄ› drÅ¾itel soukromÃ©ho klÃ­Äe nÃ¡leÅ¾Ã­cÃ­mu k publikovanÃ©mu veÅ™ejnÃ©mu. Tomuto se Å™Ã­kÃ¡ kryptografickÃ½ podpis a v Bitcoinu je jÃ­m prokazovÃ¡no, Å¾e vÃ½stup je utrÃ¡cen prÃ¡vÄ› drÅ¾itelem soukromÃ©ho klÃ­Äe pÅ™isluÅ¡Ã­cÃ­ho k veÅ™ejnÃ©mu klÃ­Äi, ve prospÄ›ch jehoÅ¾ hashe byl vÃ½stup uzamÄen. (Å½e je vÃ½stup uzamÄen ve prospÄ›ch nikoliv pÅ™Ã­mo veÅ™ejnÃ©ho klÃ­Äe, nÃ½brÅ¾ jeho hashe, je jen dalÅ¡Ã­m stupnÄ›m ochrany.) </p>
      <p class="just">AsymetrickÃ¡ kryptografie eliptickÃ½ch kÅ™ivek je zaloÅ¾ena na tzv. problÃ©mu diskrÃ©tnÃ­ho logaritmu: </p>
      <p class="math">NechÅ¥ <em>G &equals; &lang;a&rang;</em> je cyklickÃ¡ grupa Å™Ã¡du <em>n</em> s generÃ¡torem grupy <em>a</em>. KaÅ¾dÃ½ prvek <em>b &isin; G</em> lze zapsat jako b &equals; a<sup>x</sup> pro jedinÃ© x &isin; <img src="https://btc-slovnik.cz/img/zet.svg" alt="Z"><sub>n</sub>. Toto <em>x</em> se nazÃ½vÃ¡ <strong>diskrÃ©tnÃ­ logaritmus</strong> o zÃ¡kladu <em>a</em> z prvku <em>b</em> v grupÄ› <em>G</em>. </p>
      <p class="just">PÅ™iÄemÅ¾ v Bitcoinu je uÅ¾ita eliptickÃ¡ kÅ™ivka popsanÃ¡ standardem secp256k1: </p>
      <ul class="article">
        <li>KÅ™ivka nad <a href="https://btc-slovnik.cz/pages/math.html">koneÄnÃ½m tÄ›lesem</a> s charakteristikou tÄ›lesa p &equals;
          0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f
          (tj. takÃ© 2<sup>256</sup> &minus; 2<sup>32</sup> &minus; 977)</li>
        <li>Rovnice kÅ™ivky: y<sup>2</sup> &equals; x<sup>3</sup> &plus; 7</li>
        <li>GenerÃ¡tor <a href="https://btc-slovnik.cz/pages/math.html">cyklickÃ© grupy</a> bod A mÃ¡ souÅ™adnice:
          <ul>
            <li>A<sub>x</sub> &equals; 0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798</li>
            <li>A<sub>y</sub> &equals; 0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8</li>
          </ul>
        </li>
        <li>Å˜Ã¡d grupy n &equals; 0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141</li>
        <li>Kofaktor h &equals; 1</li>
      </ul>
      <p class="just">MÃ¡me tedy eliptickou kÅ™ivku nad koneÄnÃ½m tÄ›lesem a zvolenÃ½ bod na kÅ™ivce, kterÃ½m si mÅ¯Å¾eme vygenerovat cyklickou grupu s operacÃ­ sÄÃ­tÃ¡nÃ­ bodÅ¯ na kÅ™ivce. KdyÅ¾ jsme pro opakovanÃ© sÄÃ­tÃ¡nÃ­ bodu se sebou samÃ½m <a href="https://btc-slovnik.cz/pages/math.html">zavedli operaci nÃ¡sobenÃ­ bodu skalÃ¡rem</a>, mÃ¡me vÅ¡e, co potÅ™ebuje pro vyuÅ¾itÃ­ problÃ©mu diskrÃ©tnÃ­ho logaritmu. Z vÅ™Ã­dla chaosu (nebo seedu) si vytÃ¡hneme pÅ™irozenÃ© ÄÃ­slo v intervalu &lang;1, n). To bude nÃ¡Å¡ soukromÃ½ klÃ­Ä. Provedeme nÃ¡sobenÃ­ skalÃ¡rem &ndash; soukromÃ½m klÃ­Äem vynÃ¡sobÃ­me generÃ¡tor grupy&semi; vÃ½sledkem bude bod na kÅ™ivce &ndash; nÃ¡Å¡ veÅ™ejnÃ½ klÃ­Ä. PÅ™estoÅ¾e se operace naÅ¡Ã­ aditivnÃ­ grupy jmenuje souÄet bodÅ¯ a opakovanÃ©mu sÄÃ­tÃ¡nÃ­ bodu sebou samÃ½m Å™Ã­kÃ¡me nÃ¡sobenÃ­ skalÃ¡rem, mÅ¯Å¾eme si tyto operace pÅ™edstavit v multiplikativnÃ­ notaci jako nÃ¡sobenÃ­ a opakovanÃ© nÃ¡sobenÃ­ jako umocÅˆovÃ¡nÃ­. Pak nÃ¡Å¡ postup pÅ™esnÄ› zapadne do vÃ½Å¡e uvedenÃ© definice diskrÃ©tnÃ­ho logaritmu &ndash; prvkem <em>b</em> je veÅ™ejnÃ½ klÃ­Ä, zatÃ­mco <em>x</em> je klÃ­Ä soukromÃ½. Neexistuje polynomiÃ¡lnÃ­ algoritmus, kterÃ½ by se znalostÃ­ veÅ™ejnÃ©ho klÃ­Äe a generÃ¡toru grupy vypoÄÃ­tal soukromÃ½ klÃ­Ä. MÅ¯Å¾eme jÃ­t podepisovat. </p>
      <div class="fig">
        <figure>
          <img src="https://btc-slovnik.cz/img/secp256k1.png" alt="secp256k1">
          <figcaption>Takto by vypadalo zobrazenÃ­ bitcoinovÃ© eliptickÃ© kÅ™ivky nad mnoÅ¾inou reÃ¡lnÃ½ch ÄÃ­sel.</figcaption>
        </figure>
      </div>
    </article>
    <article>
      <header>
        <h2 id="ecdsa">Anatomie podpisu</h2>
        <p class="header"><time datetime="2021-06-02">AktualizovÃ¡no: 2. 6. 2021</time></p>
      </header>
      <p class="just">SouÄasnÃ½m podpisovÃ½m schÃ©matem Bitcoinu je ECDSA. PÅ™ipravÃ­me si nÃ¡Å¡ soukromÃ½ klÃ­Ä (a oznaÄÃ­me ho jako ÄÃ­slo <em>d</em>), nÃ¡hodnÃ© ÄÃ­slo k z intervalu &lang;1, n) (ÄÃ­slo k musÃ­ bÃ½t opravdu nÃ¡hodnÃ© a rÅ¯znÃ© pro kaÅ¾dÃ½ podpis, jinak hrozÃ­ vyzrazenÃ­ soukromÃ©ho klÃ­Äe) a nÄ›jakou zprÃ¡vu, resp. jejÃ­ hash. </p>
      <p class="just">V Bitcoinu prokazujeme podpisem to, Å¾e jsme drÅ¾iteli soukromÃ©ho klÃ­Äe nÃ¡leÅ¾Ã­cÃ­ho k veÅ™ejnÃ©mu klÃ­Äi, ve prospÄ›ch jehoÅ¾ hashe jsou uzamknuty satoshi na vÃ½stupu pÅ™edchÃ¡zejÃ­cÃ­ transakce. Podepisovanou zprÃ¡vou tedy bude dvojitÃ½ SHA256 hash jakÃ©hosi pÅ™edobrazu naÅ¡Ã­ vÃ½slednÃ© transakce. VÃ½robÄ› tohoto pÅ™edobrazu se vÄ›nuje <a href="https://btc-slovnik.cz/pages/transaction.html#preimage">bonusovÃ¡ ÄÃ¡st anatomie transakce</a>. VÃ½slednÃ½ hash si oznaÄÃ­me jako ÄÃ­slo <em>e</em>. </p>
      <p class="just">VÃ½poÄet podpisu je pak jiÅ¾ jednoduchÃ½: </p>
      <ul class="article">
        <li>Provedeme operaci nÃ¡sobenÃ­ skalÃ¡rem nÃ¡hodnÃ©ho ÄÃ­sla <em>k</em> a generÃ¡toru grupy <em>A</em>, x&hyphen;ovÃ¡ souÅ™adnice vÃ½slednÃ©ho bodu mod <em>n</em> bude ÄÃ­slem <em>r</em>.</li>
        <li><em>s &equals; k<sup>-1</sup> &times; (e &plus; r &times; d)</em> mod <em>n</em>.</li>
      </ul>
      <p class="just">Dvojice ÄÃ­sel <em>r, s</em> je naÅ¡Ã­m podpisem zprÃ¡vy <em>e</em>. ZakÃ³dovÃ¡nÃ­m ÄÃ­sel <em>r, s</em> do formÃ¡tu DER (Distinguished Encoding Rules) zÃ­skÃ¡me podpisovÃ½ element pouÅ¾itelnÃ½ v <a href="https://btc-slovnik.cz/pages/transaction.html#script">sigScriptu</a>. </p>
      <p class="just">K ovÄ›Å™enÃ­ si musÃ­me opÄ›t sestavit pÅ™edobraz podepisovanÃ© transkace a vypoÄÃ­st jeho dvojnÃ¡sobnÃ½ SHA256 hash, tj. ÄÃ­slo <em>e</em>, dÃ¡le nÃ¡m jiÅ¾ staÄÃ­ z scriptSigu zÃ­skanÃ½ podpis (dvojice r, s) a veÅ™ejnÃ½ klÃ­Ä. Ten je v scriptSigu zakÃ³dovÃ¡n ve formÃ¡tu SEC (Standards of Efficient Cryptography) zpravidla pouze jako x&hyphen;ovÃ¡ souÅ™adnice a pÅ™Ã­znak sudosti &ndash; v takovÃ©m pÅ™Ã­padÄ› dopoÄÃ­tÃ¡me y&hyphen;ovou souÅ™adnici. </p>
      <p class="just">Postup ovÄ›Å™enÃ­ je pak: </p>
      <ul class="article">
        <li><em>u &equals; e &times; s<sup>-1</sup></em> mod <em>n</em>.</li>
        <li><em>v &equals; r &times; s<sup>-1</sup></em> mod <em>n</em>.</li>
        <li>Provedeme operaci nÃ¡sobenÃ­ skalÃ¡rem ÄÃ­sla <em>u</em> a generÃ¡toru grupy; potÃ© nÃ¡sobenÃ­ skalÃ¡rem ÄÃ­sla <em>v</em> a veÅ™ejnÃ©ho klÃ­Äe. VÃ½slednÃ© dva body seÄteme a oznaÄÃ­me jako bod <em>X</em>.</li>
      </ul>
      <p class="just">Pokud se x&hyphen;ovÃ¡ souÅ™adnice vypoÄtenÃ©ho bodu <em>X</em> rovnÃ¡ ÄÃ­slu <em>r</em>, pak je dvojice <em>r, s</em> platnÃ½m podpisem zprÃ¡vy <em>e</em>.</p>
      <h3 id="schnorr">Anatomie Schnorrova podpisu</h3>
      <p class="just">SchnorrÅ¯v podpis by v budoucnu mohl nahradit ECDSA schÃ©ma. Oproti nÄ›mu mÃ¡ nÄ›kolik vÃ½hod, z nichÅ¾ ta klÃ­ÄovÃ¡ je moÅ¾nost kombinovat vÃ­ce podpisÅ¯ tÃ© samÃ© zprÃ¡vy do podpisu jednoho. </p>
      <p class="just">PÅ™i podepisovÃ¡nÃ­ zaÄneme stejnÄ› jako s ECDSA, pÅ™ipravÃ­me si soukromÃ½ klÃ­Ä <em>d</em>, nÃ¡hodnÃ© ÄÃ­slo <em>k</em> a hash pÅ™edobrazu transakce <em>e</em>. Oproti ECDSA budeme ovÅ¡em navÃ­c potÅ™ebovat veÅ™ejnÃ½ klÃ­Ä: </p>
      <ul class="article">
        <li>Provedeme operaci nÃ¡sobenÃ­ skalÃ¡rem nÃ¡hodnÃ©ho ÄÃ­sla <em>k</em> a generÃ¡toru grupy <em>A</em>, vÃ½sledkem je bod
          <em>R</em>.
        </li>
        <li>Zahashujeme zÅ™etÄ›zenÃ­ reprezentace bodu <em>R</em>, veÅ™ejnÃ©ho klÃ­Äe a hashe zprÃ¡vy <em>e</em>, tento hash
          oznaÄÃ­me <em>r</em>.</li>
        <li><em>s &equals; k &plus; r &times; d</em> mod <em>n</em>.</li>
      </ul>
      <p class="just">Podpisem je tedy nikoliv dvojice ÄÃ­sel, ale dvojice bod <em>R</em> a ÄÃ­slo <em>s</em>. Tento podpis pak mÅ¯Å¾e bÃ½t ovÄ›Å™en postupem: </p>
      <ul class="article">
        <li>Zahashujeme zÅ™etÄ›zenÃ­ reprezentace bodu <em>R</em>, veÅ™ejnÃ©ho klÃ­Äe a hashe zprÃ¡vy <em>e</em>, tento hash oznaÄÃ­me <em>r</em>.</li>
        <li>Provedeme operaci nÃ¡sobenÃ­ skalÃ¡rem <em>s</em> a generÃ¡toru grupy, vÃ½slednÃ½ bod oznaÄÃ­me <em>X</em>.</li>
        <li>Provedeme operaci nÃ¡sobenÃ­ skalÃ¡rem <em>r</em> a veÅ™ejnÃ©ho klÃ­Äe, k vÃ½slednÃ©mu bodu pÅ™iÄteme bod <em>R</em> a tento souÄet oznaÄÃ­me jako bod <em>Y</em>.</li>
      </ul>
      <p class="just">Podpis je platnÃ½, pokud se body X a Y shodujÃ­. </p>
    </article>
  </div>
  <footer>
    <div class="mail">
      <p>Sepsal <a class="warp" href="mailto:iwarp@pm.me">iWarp</a> (<a class="key" href="https://btc-slovnik.cz/pages/stuff/publickey.txt">ğŸ”‘ pubkey</a>).<br><a class="key" id="lit" href="https://btc-slovnik.cz/pages/literature.html">ğŸ“š OblÃ­benÃ¡ literatura</a> | <button onclick="dropDonate()" class="dropbtn key">âš¡ Donejt</button></p>
    </div>
    <div>
      <div class="tw">
        <a class="tw" href="https://twitter.com/btcslovnik"><img src="https://btc-slovnik.cz/img/twitter.svg" height="30" alt="twitter" /></a>
        <a class="license" href="https://btc-slovnik.cz/LICENSE"><img src="https://btc-slovnik.cz/img/public80x15.png" alt="CC0" /></a>
      </div>
    </div>
    <div id="donate" class="dropdown">
      <p>PÅ™ispÄ›j mi na pivo pÅ™es LNURL:</p>
      <img class="pointer" onclick="clipboardLNURL()" src="https://btc-slovnik.cz/img/lnurl.png" alt="LNURL" />
      <p onclick="clipboardLNURL()" class="lnurl pointer">LNURL1DP68GURN8GHJ7URP0YHXYARRWDKX7ANWD94JUCM69AKXUATJD3CZ7CTSDYHHVVF0D3H82UNV9UCS5SXUCE</p>
      <a class="invoice" rel=â€nofollowâ€ href="https://pay.btcslovnik.cz/tipjar/1">Nebo mi poÅ¡li tip pÅ™es mojÃ­ lightning brÃ¡nu.</a>
    </div>
  </footer>
  <script src="https://btc-slovnik.cz/drop.js"></script>
</body>

</html>
