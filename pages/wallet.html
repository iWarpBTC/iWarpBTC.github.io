<!DOCTYPE html>
<html lang="cs">

<head>
  <meta charset="UTF-8">
  <title>Anatomie HD penÄ›Å¾enky</title>
  <meta property="og:title" content="Anatomie HD penÄ›Å¾enky">
  <link rel="shortcut icon" href="https://btc-slovnik.cz/favicon.png">
  <link rel="stylesheet" href="../css/styles.css">
  <meta name="description" content="Popisuje technologii fungovÃ¡nÃ­ bitcoinovÃ© HD penÄ›Å¾enky a odvozovÃ¡nÃ­ klÃ­ÄÅ¯.">
  <meta property="og:description" content="Popisuje technologii fungovÃ¡nÃ­ bitcoinovÃ© HD penÄ›Å¾enky a odvozovÃ¡nÃ­ klÃ­ÄÅ¯.">
  <meta name="keywords"
        content="bitcoin, penÄ›Å¾enka, hd penÄ›Å¾enka, hierarchical deterministic, seed, entropie, bip 44, bip 39, bip 32, derivaÄnÃ­ cesta">
  <link rel="canonical" href="https://btc-slovnik.cz/pages/wallet.html">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@btcslovnik" />
  <meta name="og:image" content="https://btc-slovnik.cz/img/seed_icon.svg" />
</head>

<body>
  <header>
    <div class="h1">
      <h1><a href="https://btc-slovnik.cz/#hd-wallet"><span class="bitcoin">BitcoinovÃ½</span> slovnÃ­k nauÄnÃ½</a></h1>
    </div>
  </header>
  <div class="container2">
    <article>
      <header>
        <h2>Anatomie HD penÄ›Å¾enky (BIP 32/39/44/84)</h2>
        <p class="header"><time datetime="2021-06-07">AktualizovÃ¡no: 7. 6. 2021</time></p>
      </header>
      <p class="just">Deterministicky hierarchistickÃ¡ penÄ›Å¾enka je software, kterÃ½ dokÃ¡Å¾e z tzv. poÄÃ¡teÄnÃ­ entropie (nÃ¡slednÄ› zakonzerovanÃ© ve slovech seedu) generovat prakticky neomezenÃ© mnoÅ¾stvÃ­ klÃ­ÄovÃ½ch pÃ¡rÅ¯ a tedy i adres.</p>
      <p class="just">PÅ™i prvnÃ­m spuÅ¡tÄ›nÃ­ (inicializaci) si takovÃ¡ penÄ›Å¾enka, ideÃ¡lnÄ› z nÄ›kolika rÅ¯znÃ½ch zdrojÅ¯, vygeneruje zpravidla mezi 128 a 256 bity entropie. Za to jeÅ¡tÄ› pÅ™idÃ¡ prvnÃ­ch 4 aÅ¾ 8 bitÅ¯ hashe (SHA256) tÃ©to entropie, kterÃ© slouÅ¾Ã­ jako &bdquo;kontrolnÃ­ souÄet&ldquo;. Toto ÄÃ­slo si nÃ¡slednÄ› rozdÄ›lÃ­me na 12 aÅ¾ 24 ÄÃ¡stÃ­ po 11 bitech tak, aby kaÅ¾dÃ¡ ÄÃ¡st odpovÃ­dala poÅ™adÃ­ slova ze <a href="https://github.com/bitcoin/bips/blob/master/bip-0039/english.txt">slovnÃ­ku 2048 slov</a>. Tato slova seedu jsou zobrazenÃ¡ uÅ¾ivateli, kterÃ½ je v ideÃ¡lnÃ­m pÅ™Ã­padÄ› bezpeÄnÄ› a trvanlivÄ› zaznamenÃ¡ a uchovÃ¡. TaktÃ©Å¾ penÄ›Å¾enka si tÄ›chto 132 aÅ¾ 264 bitÅ¯ dat uloÅ¾Ã­ do svÃ© pamÄ›ti. </p>
      <div class="fig">
        <figure>
          <img width="944" src="https://btc-slovnik.cz/img/seed.svg" alt="slova seedu">
          <figcaption>Entropie s kontrolnÃ­m hashem je pÅ™evÃ¡dÄ›na do slov dle BIP 39</figcaption>
        </figure>
      </div>
      <p class="just">Po inicializaci (a nÃ¡slednÄ› i pÅ™i kaÅ¾dÃ©m dalÅ¡Ã­ spuÅ¡tÄ›nÃ­) mÅ¯Å¾e bÃ½t uÅ¾ivatel vyzvÃ¡n k zadÃ¡nÃ­ passphrase (pokud si jejÃ­ pouÅ¾itÃ­ povolil). PotÃ© je zavolÃ¡na funkce PBKDF2 s hashovÃ¡nÃ­m HMAC-SHA512 a poÄtem iteracÃ­ 2048. Na vstupu je jako parametr <em>password</em> Å™etÄ›zec slov seedu a jako parametr <em>salt</em> Å™etÄ›zec passphrase (v pÅ™Ã­padÄ› vypnutÃ© passphrase prÃ¡zdnÃ½) pÅ™edsazenÃ½ Å™etÄ›zcem "mnemonic". VÃ½stupem funkce je 512bitovÃ½ seed. </p>
      <div class="fig">
        <figure>
          <img src="https://btc-slovnik.cz/img/seed2.svg" alt="512 bitÅ¯ seedu">
          <figcaption>Seed je rozÅ¡Ã­Å™en na 512 bitÅ¯</figcaption>
        </figure>
      </div>
      <p class="just">KdyÅ¾ je pak seed jako <em>message</em> spoleÄnÄ› s Å™etÄ›zcem znakÅ¯ &bdquo;Bitcoin seed&ldquo; jako <em>key</em> pÅ™iveden na vstup funkce HMAC-SHA512, dostaneme opÄ›t 512bitovÃ© ÄÃ­slo, jehoÅ¾ levÃ½ch 256 bitÅ¯ pÅ™edstavuje <strong>hlavnÃ­</strong> soukromÃ½ klÃ­Ä (master private key) a pravÃ½ch 256 bitÅ¯ pÅ™edstavuje <strong>hlavnÃ­</strong> kÃ³d Å™etÄ›zu (master chain code). Z hlavnÃ­ho soukromÃ©ho klÃ­Äe je pak moÅ¾nÃ© <a href="https://btc-slovnik.cz/pages/crypto.html">standardnÃ­m zpÅ¯sobem</a> vypoÄÃ­tat veÅ™ejnÃ½ klÃ­Ä. <strong>Kombinace kterÃ©hokoliv z klÃ­ÄÅ¯ s korespondujÃ­cÃ­m kÃ³dem Å™etÄ›zu se pak nazÃ½vÃ¡ rozÅ¡Ã­Å™enÃ½ klÃ­Ä (extended key). </strong></p>
      <div class="fig">
        <figure>
          <img width="944" src="https://btc-slovnik.cz/img/xkey.svg" alt="hlavnÃ­ klÃ­Ä">
          <figcaption>Ze seedu je odvozen hlavnÃ­ rozÅ¡Ã­Å™enÃ½ klÃ­Ä dle BIP 32</figcaption>
        </figure>
      </div>
      <p class="just">S rozÅ¡Ã­Å™enÃ½mi klÃ­Äi jiÅ¾ mÅ¯Å¾eme generovat dle libosti jejich potomky, pÅ™iÄemÅ¾ u potomkÅ¯ soukromÃ©ho klÃ­Äe se rozliÅ¡uje mezi tvrzenÃ½m a netvrzenÃ½m odvozenÃ­m. ZabÃ½vat se nynÃ­ musÃ­me nÄ›ÄÃ­m, Äemu se Å™Ã­kÃ¡ derivaÄnÃ­ cesta. DÃ­ky standardizovanÃ½m derivaÄnÃ­m cestÃ¡m dospÄ›je kaÅ¾dÃ¡ kompatibilnÃ­ penÄ›Å¾enka z danÃ©ho seedu (kombinace slov seedu a passphrase) vÅ¾dy ke stejnÃ© sadÄ› klÃ­ÄÅ¯, resp. adres. </p>
      <p class="just">Podle BIPu 44 je standardnÃ­ formÃ¡t derivaÄnÃ­ cesty: </p>
      <p class="raw">m / purpose' / coin_type' / account' / change / address_index</p>
      <p class="just">Apostrof nÃ¡m znaÄÃ­ tvrzenÃ© odvozenÃ­, kterÃ© lze provÃ¡dÄ›t pouze se znalostÃ­ soukromÃ©ho klÃ­Äe. MalÃ© m je hlavnÃ­ rozÅ¡Ã­Å™enÃ½ klÃ­Ä (master). Purpose je index ÃºÄelu â€“ 44 je vyhrazena pro pÅ¯vodnÃ­ (legacy) BTC adresy, 48 pro adresy skriptu (typicky zapouzdÅ™enÃ½ segwit, nebo nÄ›jakÃ½ multisig), 84 pak vede k nejnovÄ›jÅ¡Ã­m adresÃ¡m native segwit. Index coin_type rozliÅ¡uje mezi hlavnÃ­ sÃ­ti mainnet (0) a testovacÃ­ sÃ­tÃ­ testnet (1). Index account je poÅ™adovÃ© ÄÃ­slo ÃºÄtu. VÅ¡echny indexy jsou rozsahu 4 bajty, pÅ™iÄemÅ¾ pro tvrzenÃ© odvozovÃ¡nÃ­ jsou vyhrazeny indexy od 2<sup>31</sup> do 2<sup>32</sup>&minus;1. To dÃ¡vÃ¡ dost prostoru pro odvozenÃ­ 2&nbsp;147&nbsp;483&nbsp;647 ÃºÄtÅ¯. Index change roven nule odvozuje adresy ke zveÅ™ejnÄ›nÃ­ (ty, kterÃ© penÄ›Å¾enka zobrazuje pÅ™i kliknutÃ­ na tlaÄÃ­tko PÅ™ijmout), jedniÄka jsou vnitÅ™nÃ­ adresy uÅ¾Ã­vanÃ© penÄ›Å¾enkou k uzamÄenÃ­ zbytku pÅ™i ÃºtratÄ› pÅ™Ã­liÅ¡ velkÃ©ho UTXO. KoneÄnÄ› poslednÃ­ index jiÅ¾ ÄÃ­sluje jednotlivÃ© adresy. TÄ›ch mÅ¯Å¾e bÃ½t opÄ›t 2&nbsp;147&nbsp;483&nbsp;647 pod kaÅ¾dÃ½m ÃºÄtem. NemusÃ­te se tedy bÃ¡t pouÅ¾Ã­vat pro kaÅ¾dou transakci novou adresu tak, jak to stanovujÃ­ best practices Bitcoinu. </p>
      <p class="just">OdvozovÃ¡nÃ­ potomkÅ¯ provÃ¡dÃ­me jiÅ¾ pÅ™edstavenou funkcÃ­ HMAC-SHA512 a jako <em>key</em> slouÅ¾Ã­ ve vÅ¡ech pÅ™Ã­padech kÃ³d Å™etÄ›zu. LiÅ¡Ã­ se vstupy do <em>message</em> a to, co provÃ¡dÃ­me s vÃ½stupem. </p>
      <p class="just">NetvrzenÃ© odvozenÃ­ ze soukromÃ©ho rozÅ¡Ã­Å™enÃ©ho klÃ­Äe provedeme tak, Å¾e do <em>message</em> vloÅ¾Ã­me veÅ™ejnÃ½ klÃ­Ä a index. K levÃ½m 256 bitÅ¯m vÃ½stupu pÅ™iÄteme rodiÄovskÃ½ soukromÃ½ klÃ­Ä &ndash; to celÃ© modulo <a href="https://btc-slovnik.cz/pages/crypto.html">Å™Ã¡dem grupy</a>. TÃ­m zÃ­skÃ¡me soukromÃ½ klÃ­Ä potomka, kÃ³dem Å™etÄ›zu potomka je pravÃ½ch 256 bitÅ¯ vÃ½stupu. </p>
      <p class="just">TvrzenÃ© odvozenÃ­ ze soukromÃ©ho rozÅ¡Ã­Å™enÃ©ho klÃ­Äe se liÅ¡Ã­ od netvrzenÃ©ho pouze tÃ­m, Å¾e do <em>message</em> vloÅ¾Ã­me nulovÃ½ bajt, po nÄ›m soukromÃ½ klÃ­Ä a index z vyhrazenÃ©ho rozsahu. S vÃ½stupem si jiÅ¾ poÄÃ­nÃ¡me stejnÄ›. </p>
      <p class="just">A koneÄnÄ› odvozenÃ­ potomka od veÅ™ejnÃ©ho klÃ­Äe provedeme tak, Å¾e do <em>message</em> vloÅ¾Ã­me serializovanÃ½ veÅ™ejnÃ½ klÃ­Ä a index. LevÃ½ch 256 bitÅ¯ pouÅ¾ijeme jako <a href="https://btc-slovnik.cz/pages/crypto.html">skalÃ¡r pro nÃ¡sobenÃ­ generÃ¡toru grupy</a>, vÃ½slednÃ½ bod pÅ™iÄteme k veÅ™ejnÃ©mu klÃ­Äi rodiÄe a dostaneme veÅ™ejnÃ½ klÃ­Ä potomka, pravÃ½ch 256 bitÅ¯ je opÄ›t kÃ³dem Å™etÄ›zu potomka. </p>
      <p class="just">Pro pÅ™enos rozÅ¡Ã­Å™enÃ½ch klÃ­ÄÅ¯ se pouÅ¾ije nÃ¡sledujÃ­cÃ­ serializace zakÃ³dovanÃ¡ v Base58Check:
      <ul class="article">
        <li>4 bajty verze &ndash; 0x0488ade4 pro soukromÃ½ klÃ­Ä se zakÃ³duje jako xprv; 0x0488b21e pro veÅ™ejnÃ½ klÃ­Ä bude xpub</li>
        <li>1 bajt hloubky &ndash; poÄtu odvozenÃ­ od hlavnÃ­ho klÃ­Äe</li>
        <li>4 bajty otisku rodiÄe â€“ prvnÃ­ 4 bajty RIPEMD160 ze SHA256 rodiÄovskÃ©ho klÃ­Äe (0x00000000 pro hlavnÃ­ klÃ­Ä)</li>
        <li>4 bajty pro index tohoto potomka (0x00000000 pro hlavnÃ­ klÃ­Ä)</li>
        <li>32 bajtÅ¯ pro kÃ³d Å™etÄ›zu</li>
        <li>33 bajtÅ¯
          pro klÃ­Ä (v pÅ™Ã­padÄ› soukromÃ©ho pÅ™edsazeno 0x00)</li>
      </ul>
    </article>
  </div>
  <footer>
    <div class="mail">
      <p>Sepsal <a class="warp" href="mailto:iwarp@pm.me">iWarp</a> (<a class="key" href="https://btc-slovnik.cz/pages/stuff/publickey.txt">ğŸ”‘ pubkey</a>).<br><a class="key" href="https://btc-slovnik.cz/pages/literature.html">ğŸ“š OblÃ­benÃ¡ literatura</a> | <button onclick="dropDonate()" class="dropbtn key">âš¡ Donejt</button></p>
    </div>
    <div>
      <div class="tw">
        <a class="tw" href="https://twitter.com/btcslovnik"><img src="https://btc-slovnik.cz/img/twitter.svg" height="30" alt="twitter" /></a>
        <a class="license" href="https://btc-slovnik.cz/LICENSE"><img src="https://btc-slovnik.cz/img/public80x15.png" alt="CC0" /></a>
      </div>
    </div>
    <div id="donate" class="dropdown">
        <p>PÅ™ispÄ›j mi na pivo pÅ™es LNURL:</p>
        <img class="pointer" onclick="clipboardLNURL()" src="https://btc-slovnik.cz/img/lnurl.png" alt="LNURL" />
        <p onclick="clipboardLNURL()" class="lnurl pointer">LNURL1DP68GURN8GHJ7URP0YHXYARRWDKX7ANWD94JUCM69AKXUATJD3CZ7CTSDYHHVVF0D3H82UNV9UCS5SXUCE</p>
        <a class="invoice" rel=â€nofollowâ€ href="https://pay.btcslovnik.cz/tipjar/1">Nebo mi poÅ¡li tip pÅ™es mojÃ­ lightning brÃ¡nu.</a>
    </div>
  </footer>
  <script src="https://btc-slovnik.cz/drop.js"></script>
</body>

</html>
